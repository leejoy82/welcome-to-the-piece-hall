<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to The Piece Hall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- A-Frame and AR.js libraries for Web AR -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <!-- PWA Manifest and Theme Color -->
    <link rel="manifest" id="manifest">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/leejoy82/welcome-to-the-piece-hall/main/icon-192.png">

    <style>
        /* Embedded Shared Styles */
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #000000;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        .bg-sandstone-gold { background-color: #B3A369; }
        .text-parchment { color: #F5F5DC; }
        .text-sandstone-gold { color: #B3A369; }
        .border-sandstone-gold { border-color: #B3A369; }
        .content-page-header {
            background-color: #111111;
            border-bottom: 1px solid #B3A369;
        }
        /* Helper class to hide/show pages */
        .page-section.hidden {
            display: none;
        }
        /* Styles for AR overlay elements */
        .ar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0,0,0,0.8);
            color: white;
            text-align: center;
            padding: 20px;
        }
        /* Custom styles for planner */
        #itinerary-result h3 {
            font-size: 1.5rem; /* Larger than before */
            font-family: 'Playfair Display', serif;
            font-weight: bold;
            color: #B3A369;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #B3A369;
            padding-bottom: 0.5rem;
        }
        #itinerary-result ul {
            list-style-type: '✧ ';
            list-style-position: inside;
            margin-left: 0.5rem;
            line-height: 1.7;
        }
        #itinerary-result p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }
        #itinerary-result strong {
            font-weight: bold;
            color: #F5F5DC;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #B3A369;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Dynamic Background Style */
        #hub-page {
            background-size: cover;
            background-position: center;
            transition: background-image 1s ease-in-out;
        }
        /* General page content styling */
        .page-content {
            line-height: 1.7;
            font-size: 1.1rem;
        }
        .page-content h3 {
            font-size: 1.75rem;
            color: #B3A369;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .page-content p {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="text-parchment" style="overflow-x: hidden;">

    <!-- =========== HOME HUB PAGE =========== -->
    <main id="hub-page" class="page-section min-h-screen flex flex-col items-center justify-center p-4 sm:p-6">
        <div class="w-full max-w-md mx-auto text-center bg-black bg-opacity-60 p-6 rounded-lg">
            <header class="mb-10">
                <svg class="h-20 mx-auto mb-6" viewBox="0 0 100 125" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M50.003 0C22.383 0 0 22.383 0 50.003s22.383 50.003 50.003 50.003 50.003-22.383 50.003-50.003S77.623 0 50.003 0zm0 91.672c-23.008 0-41.669-18.66-41.669-41.669S26.995 8.334 50.003 8.334s41.669 18.66 41.669 41.669-18.66 41.669-41.669 41.669z" fill="#F5F5DC"/><path d="M50.003 16.667C31.583 16.667 16.667 31.583 16.667 50.003c0 18.42 14.916 33.336 33.336 33.336 18.42 0 33.336-14.916 33.336-33.336 0-18.42-14.916-33.336-33.336-33.336zm-8.334 52.78V30.557h16.668v13.89h-8.334v21.523l8.334.004v13.89h-16.668z" fill="#F5F5DC"/></svg>
                <h1 class="text-4xl md:text-5xl font-bold text-sandstone-gold">Welcome to The Piece Hall</h1>
                <p class="text-lg text-parchment/70 mt-2" id="current-date">Your guide for today</p>
            </header>
            <div class="space-y-4">
                 <button data-target="planner-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <span class="text-2xl mr-4">✨</span>
                    <span class="flex-grow text-left">Plan My Visit</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                <button data-target="ar-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-4"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                    <span class="flex-grow text-left">AR Wayfinder</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                <button data-target="map-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-4"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                    <span class="flex-grow text-left">Wayfinding & Amenities</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                 <button data-target="shops-only-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-4"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><line x1="3" x2="21" y1="6" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                    <span class="flex-grow text-left">Shops</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                 <button data-target="eateries-only-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-4"><path d="M16 2a5 5 0 0 0-9 2.46L6 6h12l-1-1.54A5 5 0 0 0 16 2Z"/><path d="M6 6h12v3c0 2.2-1.8 4-4 4H10c-2.2 0-4-1.8-4-4V6Z"/><path d="M6 13h12l-2 8H8l-2-8Z"/><path d="m12 6 1.4-2.5"/></svg>
                    <span class="flex-grow text-left">Eateries</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                <button data-target="events-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-4"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="m16 14-4 4-2-2"/></svg>
                    <span class="flex-grow text-left">Events & Tickets</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                <button data-target="club-1779-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-4"><path d="M12 2 2.5 6.5v11L12 22l9.5-4.5v-11L12 2z"/><path d="m12 14.5-5-2.5"/><path d="M12 14.5v5.5"/><path d="m12 14.5 5-2.5"/><path d="m17 9.5-5 2.5"/><path d="m7 9.5 5 2.5"/></svg>
                    <span class="flex-grow text-left">Club 1779</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
                <button data-target="history-page" class="page-link flex items-center w-full p-4 bg-sandstone-gold text-black font-semibold rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-4"><path d="M12 5v14"/><path d="M18 5v14"/><path d="M22 19H2"/><path d="M18 5a4 4 0 0 0-8 0"/><path d="M12 5a4 4 0 0 1 8 0"/><path d="M6 5v14"/></svg>
                    <span class="flex-grow text-left">History & Heritage</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            </div>
            <footer class="mt-12">
                <div class="flex justify-center space-x-6">
                    <a href="https://www.facebook.com/thepiecehallhalifax/" target="_blank" class="text-parchment/60 transition-colors duration-200 hover:text-sandstone-gold" aria-label="Facebook">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
                    </a>
                    <a href="https://www.instagram.com/thepiecehallhalifax/" target="_blank" class="text-parchment/60 transition-colors duration-200 hover:text-sandstone-gold" aria-label="Instagram">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>
                    </a>
                    <a href="https://twitter.com/ThePieceHall" target="_blank" class="text-parchment/60 transition-colors duration-200 hover:text-sandstone-gold" aria-label="Twitter/X">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M22 4s-.7 2.1-2 3.4c1.6 1.4 3.3 4.9 3.3 4.9s-1.4.6-2.8.4c-1.2 2.2-4.1 4.5-8.2 4.5-2.8 0-4.5-1.2-5.7-2.9-3.4 2.1-8.5 2.1-8.5 2.1s2.5-4.4 7.1-7.2c-1.5-1.4-2.8-3.4-2.8-3.4s1.2-.6 2.3-.2c1.1-2.2 4.1-4.5 8.2-4.5 2.8 0 4.5 1.2 5.7 2.9Z"/></svg>
                    </a>
                </div>
            </footer>
        </div>
    </main>

    <!-- =========== CONTENT PAGES =========== -->
    <!-- Helper function to create a back button header -->
    <template id="page-header-template">
         <header class="content-page-header sticky top-0 z-10 p-4 grid grid-cols-[auto_1fr_auto] items-center gap-2">
            <button class="back-button p-2 rounded-full hover:bg-sandstone-gold/20">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-sandstone-gold"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            <h2 class="text-2xl font-bold text-sandstone-gold text-center truncate"></h2>
            <div class="w-10 h-10"></div> <!-- Invisible spacer to balance the back button -->
        </header>
    </template>
    
    <!-- Itinerary Planner Page -->
    <div id="planner-page" class="page-section hidden bg-black min-h-screen">
        <!-- Header will be injected here by JS -->
        <div class="p-6">
            <p class="text-center text-lg text-parchment/80 mb-8">Tell us about your perfect day, and we'll craft a unique itinerary just for you.</p>
            <form id="itinerary-form" class="space-y-6 max-w-lg mx-auto">
                <div>
                    <label class="block text-sandstone-gold font-semibold mb-2">How much time do you have?</label>
                    <select id="visit-duration" class="w-full bg-gray-800 border border-sandstone-gold rounded-lg p-3 text-parchment focus:ring-yellow-500 focus:border-yellow-500">
                        <option>A quick visit (1-2 hours)</option>
                        <option selected>A leisurely half-day</option>
                        <option>A full day experience</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sandstone-gold font-semibold mb-3">What are your interests?</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="flex items-center space-x-3 p-3 bg-gray-800 border border-gray-700 rounded-lg"><input type="checkbox" data-interest="History & Heritage" class="h-5 w-5 rounded bg-gray-700 border-gray-600 text-yellow-600 focus:ring-yellow-500"><span>History</span></label>
                        <label class="flex items-center space-x-3 p-3 bg-gray-800 border border-gray-700 rounded-lg"><input type="checkbox" data-interest="shopping for unique gifts" class="h-5 w-5 rounded bg-gray-700 border-gray-600 text-yellow-600 focus:ring-yellow-500"><span>Shopping</span></label>
                        <label class="flex items-center space-x-3 p-3 bg-gray-800 border border-gray-700 rounded-lg"><input type="checkbox" data-interest="food & drink" class="h-5 w-5 rounded bg-gray-700 border-gray-600 text-yellow-600 focus:ring-yellow-500"><span>Food & Drink</span></label>
                        <label class="flex items-center space-x-3 p-3 bg-gray-800 border border-gray-700 rounded-lg"><input type="checkbox" data-interest="family fun" class="h-5 w-5 rounded bg-gray-700 border-gray-600 text-yellow-600 focus:ring-yellow-500"><span>Family Fun</span></label>
                        <label class="flex items-center space-x-3 p-3 bg-gray-800 border border-gray-700 rounded-lg"><input type="checkbox" data-interest="art & culture" class="h-5 w-5 rounded bg-gray-700 border-gray-600 text-yellow-600 focus:ring-yellow-500"><span>Art & Culture</span></label>
                        <label class="flex items-center space-x-3 p-3 bg-gray-800 border border-gray-700 rounded-lg"><input type="checkbox" data-interest="relaxing and soaking up the atmosphere" class="h-5 w-5 rounded bg-gray-700 border-gray-600 text-yellow-600 focus:ring-yellow-500"><span>Relaxing</span></label>
                    </div>
                </div>
                <button type="submit" class="w-full p-4 bg-sandstone-gold text-black font-bold text-lg rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">Generate My Itinerary</button>
            </form>
            <div id="itinerary-result-container" class="mt-10 max-w-2xl mx-auto hidden">
                <div class="loader"></div>
                <div id="itinerary-result" class="prose prose-invert"></div>
            </div>
        </div>
    </div>
    
    <!-- AR Wayfinder Page -->
    <div id="ar-page" class="page-section hidden">
        <!-- AR content will be dynamically injected here -->
    </div>
    
    <!-- Map & Amenities Page -->
    <div id="map-page" class="page-section hidden bg-black min-h-screen">
        <!-- Header will be injected here by JS -->
        <div class="p-4 md:p-6 text-center">
             <h3 class="text-2xl font-bold text-sandstone-gold mb-4">Interactive Map</h3>
             <p class="text-parchment/70 mb-4">Click on a label to highlight an area.</p>
            <svg id="interactive-map" viewBox="0 0 800 600" class="w-full max-w-4xl mx-auto bg-gray-900 rounded-lg border-2 border-sandstone-gold">
                <!-- Outer Walls -->
                <rect x="50" y="50" width="700" height="500" rx="15" fill="#333" stroke="#B3A369" stroke-width="2"/>
                <!-- Courtyard -->
                <rect x="150" y="150" width="500" height="300" fill="#222" />

                <!-- Colonnades -->
                <rect x="150" y="150" width="500" height="50" fill="#444"/> <!-- Top -->
                <rect x="150" y="400" width="500" height="50" fill="#444"/> <!-- Bottom -->
                <rect x="150" y="200" width="50" height="200" fill="#444"/> <!-- Left -->
                <rect x="600" y="200" width="50" height="200" fill="#444"/> <!-- Right -->
                
                <!-- Gates -->
                <g class="map-label" data-area="north-gate">
                    <rect x="375" y="50" width="50" height="20" fill="#B3A369" />
                    <text x="400" y="100" fill="#F5F5DC" text-anchor="middle" font-size="18" font-family="Montserrat">North Gate</text>
                </g>
                <g class="map-label" data-area="south-gate">
                    <rect x="375" y="530" width="50" height="20" fill="#B3A369" />
                    <text x="400" y="495" fill="#F5F5DC" text-anchor="middle" font-size="18" font-family="Montserrat">South Gate</text>
                </g>

                <!-- Key Locations -->
                <g class="map-label" data-area="toilets">
                    <circle cx="185" cy="185" r="10" fill="lightblue" />
                    <text x="215" y="190" fill="#F5F5DC" font-size="16" font-family="Montserrat">Toilets</text>
                </g>
                <g class="map-label" data-area="visitor-centre">
                    <circle cx="580" cy="420" r="10" fill="lightgreen" />
                    <text x="500" y="425" fill="#F5F5DC" font-size="16" font-family="Montserrat">Visitor Centre</text>
                </g>
                 <g class="map-label" data-area="restaurant">
                    <circle cx="620" cy="185" r="10" fill="coral" />
                    <text x="560" y="190" fill="#F5F5DC" font-size="16" font-family="Montserrat">Restaurant</text>
                </g>
            </svg>
            <div class="mt-8 page-content max-w-3xl mx-auto text-left">
                <h3 class="text-2xl font-bold text-sandstone-gold">Amenities</h3>
                <ul class="list-disc list-inside space-y-2 text-lg">
                    <li><strong class="text-sandstone-gold">Toilets & Baby Changing:</strong> Located on the Rustic level near the North Gate entrance.</li>
                    <li><strong class="text-sandstone-gold">Visitor Centre:</strong> Find maps, gifts, and friendly advice on the Colonnade level near the South Gate.</li>
                    <li><strong class="text-sandstone-gold">Accessibility:</strong> Lifts are available to access all three levels. The courtyard is wheelchair accessible.</li>
                    <li><strong class="text-sandstone-gold">Free Wi-Fi:</strong> Connect to 'PieceHall_FreeWiFi' throughout the venue.</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div id="shops-only-page" class="page-section hidden bg-black min-h-screen">
        <!-- Header will be injected here by JS -->
    </div>
    
    <div id="eateries-only-page" class="page-section hidden bg-black min-h-screen">
        <!-- Header will be injected here by JS -->
    </div>

    <div id="events-page" class="page-section hidden bg-black min-h-screen">
       <!-- Header will be injected here by JS -->
        <!-- Event content will be injected here -->
    </div>

    <div id="club-1779-page" class="page-section hidden bg-black min-h-screen">
        <!-- Header will be injected here by JS -->
        <div class="p-6 page-content max-w-3xl mx-auto">
            <div class="text-center mb-8">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-16 h-16 mx-auto text-sandstone-gold mb-4"><path d="M12 2 2.5 6.5v11L12 22l9.5-4.5v-11L12 2z"/><path d="m12 14.5-5-2.5"/><path d="M12 14.5v5.5"/><path d="m12 14.5 5-2.5"/><path d="m17 9.5-5 2.5"/><path d="m7 9.5 5 2.5"/></svg>
                <h1 class="text-4xl text-sandstone-gold">Join Club 1779 Today</h1>
                <p class="text-xl text-parchment/80 mt-2">Become part of our story and help protect our future.</p>
            </div>
            
            <h3>Why Your Support Matters</h3>
            <p>The Piece Hall is the last building of its kind in the world, and it costs £12,000 a day to maintain and run. By joining our members club, you help us protect this iconic heritage site for future generations, ensuring it remains free for everyone to enter and supporting our vibrant events programme.</p>
            
            <h3>What's In It For You?</h3>
            <p>Support us for <strong class="text-sandstone-gold">£39.95 per year</strong> or <strong class="text-sandstone-gold">£500 for a lifetime membership</strong> (£250 for over 65s), and in return you’ll get a host of fantastic perks:</p>
            <ul class="list-disc list-inside space-y-3 text-lg mt-4">
                <li>Access to presales for a selection of 'Live at The Piece Hall' gigs, shows and workshops.</li>
                <li>Invites to exclusive club members’ events and previews.</li>
                <li>Money off vouchers and special offers at participating Piece Hall outlets.</li>
                <li>A specially designed tote bag and a bespoke badge.</li>
                <li>A free heritage tour and a chance to ring The Piece Hall Bell.</li>
            </ul>
            <a href="https://thepiecehall.digitickets.co.uk/category/39263" target="_blank" rel="noopener noreferrer" class="mt-8 block w-full max-w-xs mx-auto p-4 bg-sandstone-gold text-black font-bold text-lg text-center rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">Become a Club 1779 Member</a>
        </div>
    </div>

    <div id="history-page" class="page-section hidden bg-black min-h-screen">
       <!-- Header will be injected here by JS -->
        <div class="p-6 page-content max-w-3xl mx-auto">
            <img src="https://www.thepiecehall.co.uk/wp-content/uploads/2021/05/44_header-1920x728.jpeg" alt="A sunny day in The Piece Hall Courtyard" class="rounded-lg mb-6 w-full h-auto">
            <p class="text-xl italic text-parchment/80">"Yorkshire’s most important secular building, the only remaining Georgian cloth hall in the world."</p>
            
            <h3>A Monument to Trade</h3>
            <p>Opened on New Year's Day in 1779, The Piece Hall was a grand statement of wealth and ambition. It was built as a marketplace for the trading of 'pieces' of cloth—30-yard lengths of hand-woven woollen fabric. For over 50 years, this magnificent building was the epicentre of the global woollen trade, a stunning combination of commerce and culture, and the pride of Halifax.</p>

            <h3>An Icon Reimagined</h3>
            <p>As the Industrial Revolution introduced machinery and mills, the traditional hand-weaving trade declined, and so did The Piece Hall's original purpose. But the building adapted. In 1868, it was gifted to the town and transformed into a bustling wholesale market. It became a public square for all occasions, hosting everything from political rallies and huge concerts to spectacles like the first hot air balloon ascents in 1824.</p>

            <h3>Conservation and The Future</h3>
            <p>Despite falling into disrepair, the building's significance was recognised when it was made an Ancient Monument in 1928. After the wholesale market closed, a major restoration in the 1970s saved it from demolition. Another multi-million-pound transformation, completed in 2017, has secured its future. Today, The Piece Hall is a vibrant cultural and commercial heart for Halifax, home to independent shops, bars, cafes, and a world-class events programme, continuing its story for a new generation.</p>
            
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                 <a href="https://www.thepiecehall.co.uk/heritage/heritage-spaces/" target="_blank" rel="noopener noreferrer" class="block p-4 bg-sandstone-gold text-black font-bold text-center rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    Explore Heritage Spaces
                 </a>
                 <a href="https://www.thepiecehall.co.uk/heritage/heritage-tours/" target="_blank" rel="noopener noreferrer" class="block p-4 bg-sandstone-gold text-black font-bold text-center rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">
                    Book a Heritage Tour
                 </a>
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const pageLinks = document.querySelectorAll('.page-link');
        const pageSections = document.querySelectorAll('.page-section');
        const dateElement = document.getElementById('current-date');
        const hubPage = document.getElementById('hub-page');
        let navigationStack = ['hub-page'];

        // --- PWA & DYNAMIC CONTENT ---
        const manifestData = {
            "name": "The Piece Hall Kiosk", "short_name": "Piece Hall", "start_url": ".", "display": "standalone", "background_color": "#000000", "theme_color": "#000000",
            "description": "Your official digital guide to The Piece Hall, Halifax.",
            "icons": [{"src": "https://raw.githubusercontent.com/leejoy82/welcome-to-the-piece-hall/main/icon-192.png", "sizes": "192x192", "type": "image/png" }, {"src": "https://raw.githubusercontent.com/leejoy82/welcome-to-the-piece-hall/main/icon-512.png", "sizes": "512x512", "type": "image/png" }]
        };
        const manifestString = JSON.stringify(manifestData);
        const manifestBlob = new Blob([manifestString], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        document.querySelector('#manifest').setAttribute('href', manifestUrl);
        
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: true };
            dateElement.textContent = `${now.toLocaleDateString('en-GB', dateOptions)} | ${now.toLocaleTimeString('en-US', timeOptions)}`;
        }

        function setDynamicBackground() {
            const hour = new Date().getHours();
            let imageUrl;
            if (hour >= 5 && hour < 12) imageUrl = 'https://raw.githubusercontent.com/leejoy82/welcome-to-the-piece-hall/main/morning.jpg';
            else if (hour >= 12 && hour < 18) imageUrl = 'https://raw.githubusercontent.com/leejoy82/welcome-to-the-piece-hall/main/day.jpg';
            else imageUrl = 'https://raw.githubusercontent.com/leejoy82/welcome-to-the-piece-hall/main/night.jpg';
            hubPage.style.backgroundImage = `url('${imageUrl}')`;
        }
        
        // --- AR SCENE MANAGEMENT ---
        function initAR() {
            const arPage = document.getElementById('ar-page');
            arPage.innerHTML = `
                <div id="ar-back-button-container" class="absolute top-4 left-4 z-20"></div>
                <div id="ar-instructions" class="ar-overlay">
                    <div>
                        <h2 class="text-3xl font-bold text-sandstone-gold mb-4">AR Wayfinder Activated</h2>
                        <p class="text-lg">Please grant camera access when prompted.</p>
                        <p>Point your device at a Piece Hall marker to see augmented reality content.</p>
                        <button id="close-ar-instructions" class="mt-6 bg-sandstone-gold text-black font-bold py-2 px-4 rounded">Got it!</button>
                    </div>
                </div>
                <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
                    <a-marker preset='hiro'>
                        <a-box position='0 0.5 0' material='color: #B3A369;'></a-box>
                        <a-text value="Welcome to The Piece Hall!" position="-1 1.5 0" rotation="-90 0 0" color="#F5F5DC"></a-text>
                    </a-marker>
                    <a-entity camera></a-entity>
                </a-scene>
            `;
            // Re-attach event listeners for the newly created elements
            document.getElementById('close-ar-instructions').addEventListener('click', () => {
                document.getElementById('ar-instructions').style.display = 'none';
            });
            const backButtonClone = document.querySelector('#page-header-template .back-button').cloneNode(true);
            backButtonClone.addEventListener('click', goBack);
            document.getElementById('ar-back-button-container').appendChild(backButtonClone);
        }

        function destroyAR() {
            const arPage = document.getElementById('ar-page');
            const aScene = arPage.querySelector('a-scene');
            if (aScene) {
                aScene.pause(); // Important to release camera
                arPage.innerHTML = ''; // Clear the content
            }
        }

        // --- NAVIGATION ---
        function showPage(targetId) {
            destroyAR(); // Always destroy AR scene when navigating
            
            pageSections.forEach(page => page.classList.toggle('hidden', page.id !== targetId));
            window.scrollTo(0, 0);
            
            if (targetId === 'ar-page') {
                initAR(); // Initialize AR only when navigating to its page
            }
            
            if (targetId !== navigationStack[navigationStack.length - 1]) {
                navigationStack.push(targetId);
            }
        }
        
        function goBack() {
             if (navigationStack.length > 1) {
                navigationStack.pop();
                showPage(navigationStack[navigationStack.length - 1]);
            }
        }

        pageLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(link.getAttribute('data-target'));
            });
        });

        let touchStartX = 0;
        document.body.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, { passive: true });
        document.body.addEventListener('touchend', e => {
            const currentTarget = document.querySelector('.page-section:not(.hidden)');
            // Disable swipe back on the main hub page
            if (currentTarget && currentTarget.id === 'hub-page') return;

            const touchEndX = e.changedTouches[0].screenX;
            if (touchEndX > touchStartX + 75) {
                goBack();
            }
        });
        
        document.querySelectorAll('a[href^="http"]').forEach(link => {
            link.setAttribute('target', '_blank');
            link.setAttribute('rel', 'noopener noreferrer');
        });

        // --- PAGE INJECTIONS & SETUP ---
        function createPageHeader(pageId, title) {
            const page = document.getElementById(pageId);
            if (!page) return;
            const template = document.getElementById('page-header-template');
            const header = template.content.cloneNode(true);
            header.querySelector('h2').textContent = title;
            page.prepend(header);
            page.querySelector('.back-button').addEventListener('click', goBack);
        }
        
        const pageTitles = {
            "planner-page": "Itinerary Planner", "map-page": "Wayfinding & Amenities", "shops-only-page": "Shops",
            "eateries-only-page": "Eateries", "events-page": "Events & Tickets", "club-1779-page": "Club 1779",
            "history-page": "History & Heritage"
        };
        for(const [id, title] of Object.entries(pageTitles)) {
            createPageHeader(id, title);
        }

        function createDirectoryPage(pageId, title, items) {
             const page = document.getElementById(pageId);
             const content = document.createElement('div');
             content.className = 'p-6 grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto';
             items.forEach(item => {
                let buttonHtml = '';
                if (item.link) {
                    buttonHtml = `<div class="mt-4">
                                    <a href="${item.link}" target="_blank" rel="noopener noreferrer" class="inline-block bg-sandstone-gold text-black font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-500 transition-colors duration-200">More Info</a>
                                  </div>`;
                }

                content.innerHTML += `
                    <div class="bg-gray-900/50 border border-sandstone-gold rounded-lg p-5 flex flex-col">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-sandstone-gold">${item.name}</h3>
                            <p class="text-sm text-sandstone-gold/70 mb-2">${item.category}</p>
                            <p class="text-parchment/80">${item.description}</p>
                        </div>
                        ${buttonHtml}
                    </div>
                `;
             });
             page.appendChild(content);
        }

        function createEventsPage(pageId, events) {
            const page = document.getElementById(pageId);
            let content = `
                <div class="p-6 page-content max-w-3xl mx-auto">
                    <p class="text-center text-xl mb-8 text-parchment/80">Experience world-class music, arts, and culture in our spectacular courtyard.</p>
                    <div class="space-y-8">
            `;
            events.forEach(event => {
                content += `
                    <div class="bg-gray-900/50 border border-sandstone-gold rounded-lg p-6">
                        <p class="text-sm font-semibold text-sandstone-gold">${event.date}</p>
                        <h3 class="text-2xl mt-1 mb-2">${event.name}</h3>
                        <p class="text-parchment/80 mb-4">${event.description}</p>
                        <a href="${event.link}" target="_blank" rel="noopener noreferrer" class="inline-block bg-sandstone-gold text-black font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-500 transition-colors duration-200">View Event</a>
                    </div>
                `;
            });
            content += `
                    </div>
                    <a href="https://www.thepiecehall.co.uk/events/" target="_blank" rel="noopener noreferrer" class="mt-8 block w-full max-w-xs mx-auto p-4 bg-sandstone-gold text-black font-bold text-lg text-center rounded-lg shadow-lg transform transition-all duration-200 hover:bg-yellow-500">View Full Events Calendar</a>
                </div>
            `;
            page.innerHTML += content;
        }

        createEventsPage('events-page', [
             { name: 'Paint and Sip: Cocktail night', date: '26th September 2025', description: 'Unleash your creativity with a paintbrush in one hand and a cocktail in the other in this fun, relaxed workshop.', link: 'https://www.thepiecehall.co.uk/event/paint-and-sip-cocktail-night/'},
             { name: 'Book Signing with Simon Armitage', date: '6th October 2025', description: 'Meet the Poet Laureate, Simon Armitage, and get your book signed in this special literary event.', link: 'https://www.thepiecehall.co.uk/event/book-signing-with-poet-laureate-simon-armitage/'},
             { name: 'Real Markets at The Piece Hall', date: '12th October 2025', description: 'Explore a vibrant market featuring local produce, crafts, and delicious street food from the region\'s finest artisans.', link: 'https://www.thepiecehall.co.uk/event/real-markets-at-the-piece-hall-2/'},
             { name: 'The Piece Hall Christmas Market', date: 'Weekends from 14th Nov - 21st Dec 2025', description: 'Get into the festive spirit with our magical Christmas market, featuring unique gifts, seasonal treats, and live music.', link: 'https://www.thepiecehall.co.uk/event/christmas-markets/'},
             { name: 'Christmas Parties at The Piece Hall', date: '1st - 22nd December 2025', description: 'Celebrate the festive season in style with a special Christmas party in our unique and historic venue.', link: 'https://www.thepiecehall.co.uk/event/christmas-parties-at-the-piece-hall/'},
             { name: 'ETHEL CAIN', date: '20th June 2026', description: 'A live music performance by the acclaimed artist Ethel Cain in the spectacular open-air courtyard.', link: 'https://www.thepiecehall.co.uk/event/ethel-cain/'},
             { name: 'David Gray', date: '5th July 2026', description: 'Enjoy an unforgettable evening of music with celebrated singer-songwriter David Gray.', link: 'https://www.thepiecehall.co.uk/event/david-gray/'},
             { name: 'The K’s', date: '8th August 2026', description: 'High-energy indie rock comes to the courtyard with a much-anticipated performance from The K\'s.', link: 'https://www.thepiecehall.co.uk/event/the-ks/'}
        ]);

        createDirectoryPage('shops-only-page', 'Shops', [
            { name: 'The Society of Alchemists', category: 'Gifts', description: 'Unique and curious gifts with a touch of magic and mystery.', link: 'https://www.thepiecehall.co.uk/traders/the-society-of-alchemists/' },
            { name: 'Little Acorn Gifts', category: 'Gifts', description: 'Charming gifts and keepsakes for all ages.', link: 'https://www.thepiecehall.co.uk/traders/little-acorn-gifts/' },
            { name: 'Indian Summer', category: 'Fashion & Accessories', description: 'Bohemian-inspired fashion, accessories, and homeware.', link: 'https://www.thepiecehall.co.uk/traders/indian-summer/' },
            { name: 'Hudson Belle', category: 'Gifts & Homeware', description: 'A curated collection of stylish gifts, homeware, and lifestyle products.', link: 'https://www.thepiecehall.co.uk/traders/hudson-belle/' },
            { name: 'The Escaporium', category: 'Leisure', description: 'Thrilling escape room experiences for groups of all sizes.', link: 'https://www.thepiecehall.co.uk/traders/the-escaporium/' },
            { name: 'The Yorkshire Soap Company', category: 'Gifts', description: 'Handmade soaps, bath treats, and beautifully scented gifts.', link: 'https://www.thepiecehall.co.uk/traders/the-yorkshire-soap-company/' },
            { name: 'The Book Corner', category: 'Leisure & Books', description: 'A charming independent bookshop with a curated selection of reads.', link: 'https://www.thepiecehall.co.uk/traders/the-book-corner/' },
            { name: 'Just Gaia', category: 'Food & Drink', description: 'An eco-friendly store offering zero-waste refills and sustainable products.', link: 'https://www.thepiecehall.co.uk/traders/just-gaia/' },
            { name: 'Creative Crystals', category: 'Arts & Crafts', description: 'A dazzling array of crystals, gemstones, and holistic gifts.', link: 'https://www.thepiecehall.co.uk/traders/creative-crystals/' },
            { name: 'The Yorkshire Gallery', category: 'Arts & Crafts', description: 'Showcasing paintings and sculptures from talented Yorkshire artists.', link: 'https://www.thepiecehall.co.uk/traders/the-yorkshire-gallery/' },
            { name: 'Jitterbug Jean', category: 'Fashion & Accessories', description: 'Vintage and retro-inspired clothing and accessories.', link: 'https://www.thepiecehall.co.uk/traders/jitterbug-jean/' },
            { name: 'The Handmade Gift Shop', category: 'Arts & Crafts', description: 'A wonderful collection of items from local makers and artists.', link: 'https://www.thepiecehall.co.uk/traders/the-handmade-gift-shop/' }
        ]);
        createDirectoryPage('eateries-only-page', 'Eateries', [
            { name: 'The Hop Yard', category: 'Bar', description: 'A specialist craft beer bar offering a wide selection of local and international brews.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/the-hop-yard/' },
            { name: 'La Piazza', category: 'Cafe', description: 'Authentic Italian coffee and pastries, bringing a taste of Italy to the courtyard.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/la-piazza/' },
            { name: 'The Trading Rooms', category: 'Bar & Restaurant', description: 'Fine dining with a menu inspired by Yorkshire produce. Perfect for a special occasion.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/the-trading-rooms/' },
            { name: 'The Deli', category: 'Cafe & Artisan Foods', description: 'Pick up delicious cheeses, cured meats, and local preserves to take home.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/the-deli/' },
            { name: 'The Astronomer Diner', category: 'Cafe & Diner', description: 'A quirky, space-themed diner serving American classics and delicious milkshakes.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/astronomer-diner/' },
            { name: 'The Wine Barrel', category: 'Wine Bar', description: 'An intimate bar offering a wide selection of fine wines and charcuterie boards.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/the-wine-barrel/' },
            { name: 'The Bakery', category: 'Bar & Cafe', description: 'Freshly baked bread, cakes, and sandwiches, with a charming cafe space to enjoy them.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/the-bakery/' },
            { name: 'Loafers', category: 'Bar & Cafe', description: 'A unique blend of a record store and a cafe, serving great coffee and vinyl culture.', link: 'https://www.thepiecehall.co.uk/eat-and-drink/loafers/' }
        ]);


        // --- GEMINI API ITINERARY PLANNER ---
        const itineraryForm = document.getElementById('itinerary-form');
        const resultContainer = document.getElementById('itinerary-result-container');
        const itineraryResultDiv = document.getElementById('itinerary-result');
        const loader = resultContainer.querySelector('.loader');

        itineraryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            resultContainer.style.display = 'block';
            loader.style.display = 'block';
            itineraryResultDiv.innerHTML = '';

            const duration = document.getElementById('visit-duration').value;
            const interests = [...document.querySelectorAll('input[type="checkbox"]:checked')].map(cb => cb.dataset.interest);
            const interestsText = interests.length > 0 ? interests.join(', ') : 'a bit of everything';

            const systemPrompt = `You are a friendly and knowledgeable tour guide for The Piece Hall in Halifax, a unique Grade I listed Georgian cloth hall from 1779. A visitor is asking for a personalized itinerary. Based on their interests and the time they have, create a suggested plan for their visit. The Piece Hall has a mix of independent shops (gifts, homeware, fashion, books, arts & crafts), bars (craft beer, wine), cafes, restaurants, a heritage space, and a large central courtyard that hosts events. Key shops include The Yorkshire Soap Company and The Book Corner. Key eateries include The Trading Rooms for fine dining and Loafers, a record shop cafe. Format the output using markdown with friendly headings and bullet points. Be enthusiastic and welcoming, and start with a cheerful greeting. Mention specific shops or cafes that align with the user's interests.`;
            const userQuery = `I am visiting The Piece Hall. I have ${duration} to spend and my interests are: ${interestsText}. Please create a wonderful, personalized itinerary for me.`;

            try {
                const apiKey = ""; // API key will be injected
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.statusText}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    itineraryResultDiv.innerHTML = simpleMarkdownToHtml(text);
                } else {
                    itineraryResultDiv.innerHTML = `<p class="text-center text-red-400">Sorry, I couldn't generate an itinerary at this time. Please try again later.</p>`;
                }
            } catch (error) {
                console.error("Error fetching itinerary:", error);
                itineraryResultDiv.innerHTML = `<p class="text-center text-red-400">An error occurred. Please check your connection and try again.</p>`;
            } finally {
                loader.style.display = 'none';
            }
        });
        
        function simpleMarkdownToHtml(md) {
            return md
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h3>$1</h3>') // Also handle ##
                .replace(/^# (.*$)/gim, '<h3>$1</h3>') // Also handle #
                .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*)\*/gim, '<li>$1</li>')
                .replace(/^(?!<li|<\/ul>|<h3>|<strong>|<p>)(.*)$/gim, '<p>$1</p>')
                .replace(/<\/li>\s*<p>/gim, '</li>') // Clean up paragraphs after list items
                .replace(/<\/p>\s*<li>/gim, '<ul><li>') // Start list
                .replace(/<\/li>\s*<p>/gim, '</li></ul><p>') // End list
                .replace(/<li>/g, '<ul><li>') // Ensure lists are wrapped
                .replace(/<\/li>/g, '</li></ul>')
                .replace(/<\/ul>\s*<ul>/g, ''); // Fix nested list tags
        }
        
        // --- MAP PAGE LOGIC ---
        const mapLabels = document.querySelectorAll('#interactive-map .map-label');
        mapLabels.forEach(label => {
            label.addEventListener('click', () => {
                mapLabels.forEach(l => l.style.opacity = '0.7');
                label.style.opacity = '1';
            });
        });


        // --- INITIALIZATION ---
        updateDateTime();
        setDynamicBackground();
        setInterval(updateDateTime, 60000);
    });
</script>
</body>
</html>

